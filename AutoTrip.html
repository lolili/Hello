<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<meta name="author" content="lolili">
<meta name="version" content="3.0">
<meta name="description" content="DiDi receipt editor S.">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<head>
    <title>AutoTrip</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.css" integrity="sha512-bYPO5jmStZ9WI2602V2zaivdAnbAhtfzmxnEGh9RwtlI00I9s8ulGe4oBa5XxiC6tCITJH/QG70jswBhbLkxPw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js" integrity="sha512-AIOTidJAcHBH2G/oZv9viEGXRqDNmfdPVPYOYKGy3fti0xIplnlgMHUGfuNRzC6FkzIo0iIxgFnr9RikFxK+sw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.12.1/TweenMax.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/alertify.js/0.3.11/alertify.core.min.css" integrity="sha512-JQUnm7fl0rXYdnCc1hDC9d1lAWnJezXv3unSwUIGWKyD5xl+zj8ekMI/Z2fQKemXmM670/QVe8mNcGOZvuOPjQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/alertify.js/0.3.11/alertify.default.min.css" integrity="sha512-wUS5ozkpB4c5aUrsfvYhDl6hc2oOC2AZbsKzym3DmOhBvCHs626N/NMxOdarpDKeJ1eq9cwZwNKTc3ELRnJbfQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alertify.js/0.3.11/alertify.min.js" integrity="sha512-2R8JJ9GapQ1VCvcazWIP4F7rOrMs6mzorqtZlXpvakAU0O/iw4n90CFrmG9+BwI//xxtnHxb5rbpkIF2s6z39w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>
<!-- ****************************************************************************************************************** -->
<!-- *****************************************************CSS********************************************************** -->
<!-- ****************************************************************************************************************** -->
<!-- Preview Button Selection -->
<style>
.toggle1{
  display: block;
  margin: 10px 0px 0px 0px;
}

.toggle1-input{
  display: none;
}

.toggle1-button{
  position: relative;
  display: inline-block;
  font-size: 1rem;
  line-height: 20px;
  text-transform: uppercase;
  background-color: #00b3b4;
  border: 1px solid #00b3b4;
  color: white;
  width: 100%;
  height: 30px;
  transition: all 0.3s ease;
  cursor: pointer;
}


.toggle1-button::before{
  position: absolute;
  top: 5px;
  left: 280px;
  content: "Table List";
  display: inline-block;
  height: 20px;
  padding: 0 3px;
  background: white;
  color: #00b3b4;
  transition: all 0.3s ease;
}

.toggle1-input:checked + .toggle1-button{
 background: #f2395a; 
 border-color: #f2395a;
}

.toggle1-input:checked + .toggle1-button::before{
  left: 5px;
  content: 'Pre view';
  color: #f2395a;
}
</style>

<!-- input text and download area -->
<style> 
#align-table th, #align-table td {padding: 2px 30px;text-align: left;}

strong {
  font-weight: bold;
}
.button, .area{
  background-color: #f2f2f2;
  background-image: linear-gradient(to bottom, #f2f2f2, #f2f2f2);
  border: 1px solid #bfbfbf;
  box-shadow: inset 0 1px 0 white, inset 0 -1px 0 #d9d9d9, inset 0 0 0 1px #f2f2f2, 0 2px 4px rgba(0, 0, 0, 0.2);
  color: #8c8c8c;
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
  border-radius: 3px;
  cursor: pointer;
  display: inline-block;
  font-family: Verdana, sans-serif;
  font-size: 12px;
  font-weight: 400;
  line-height: 20px;
  padding: 9px 16px 9px;
  margin: 16px 0 0 16px;
  transition: all 20ms ease-out;
  vertical-align: top;
}
.button:hover, .button:focus {
  background: #f2f2f2;
  border-color: #8c8c8c;
  box-shadow: inset 0 1px 0 white, inset 0 -1px 0 #d9d9d9, inset 0 0 0 1px #f2f2f2;
}
.button:active {
  background: #f2f2f2;
  box-shadow: inset 0 2px 3px rgba(0, 0, 0, 0.2);
}
.button .fa {
  color: #bfbfbf;
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
  font: normal normal normal 14px/1 FontAwesome;
}

.button .fa {
  float: left;
  font-size: 14px;
  line-height: 20px;
  margin: -1px 8px 0 -4px;
  vertical-align: top;
}
</style>
<!-- button -->
<style>
.Button { 
    cursor: pointer;width: 50px; height: 50px; border-radius: 25px; 
    background: none; transition: width .5s ease; color:#000; border: 4px solid 
    #000; position: relative; padding-left: 30px; color: #000; overflow: hidden; text-align: center;
}
.Button span { 
    white-space: nowrap; transition: all ease .3s; opacity: 0; font-size: 16px; line-height: 20px; transition: all ease .3s;
}
.Button:after { 
    font-size: 2.6em;
  	height: 50px;
    position: absolute;
    bottom: 0px; }
.Button-plus:after{content: "+";left: 12px;top: 0px;}
.Button-sub:after{content: "-";left: 16px;top: -3px;}

.Button:hover { width: 240px;}
.Button:hover span{ opacity: 1; transition-delay:.3s;  transition: all ease .3s; }
</style>
<style type="text/css">
    .btn {
        background-color: rgba(0, 180, 100, 1);
        border: rgba(0, 180, 100, 1) 1px, solid;
        outline: none;
        cursor: pointer;
        padding: 14px 20px;
        color: rgba(255, 255, 255, 1.0);
        text-align: center;
        font-size: 16px;
        margin: 10px;
    }
    .cir {
        padding: 13px 25px;
        border-radius: 30px;
        box-shadow: 0 3px 10px 0 rgba(0, 0, 0, 0.3);
        background: -webkit-linear-gradient(bottom, rgba(0, 180, 100, 0.2), rgba(0, 180, 100, 1), rgba(0, 200, 100, 1));
        background: -o-linear-gradient(bottom, rgba(0, 180, 100, 0.2), rgba(0, 180, 100, 1), rgba(0, 200, 100, 1));
        background: -moz-linear-gradient(bottom, rgba(0, 180, 100, 0.2), rgba(0, 180, 100, 1), rgba(0, 200, 100, 1));
        background: linear-gradient(to bottom, rgba(0, 180, 100, 0.2), rgba(0, 180, 100, 1), rgba(0, 200, 100, 1));
    }
</style>
<style type="text/css">.insert:before{content: "+";}</style>

<!-- button OK -->
<style>
    .commit {
      background: #3498db;
      width: 180px;
      padding: 4px 0;
      /*position: absolute;*/
      left: 50%;
      top: 50%;
      transform: translateX(50%) translateY(20%);
      border-radius: 3px;
    }
    .commit div {
      font-family: "Roboto";
      text-align: center;
      text-transform: uppercase;
      color: #fff;
      -webkit-user-select: none;
         -moz-user-select: none;
          -ms-user-select: none;
              user-select: none;
    }
    .commit:hover {
      cursor: pointer;
    }
    /*.commit:after {
      content: "";
      display: block;
      position: absolute;
      width: 100%;
      height: 10%;
      border-radius: 50%;
      background-color: #927608;
      opacity: 0.4;
      bottom: -30px;
    }*/
</style>
<!-- ****************************************************************************************************************** -->
<!-- *****************************************************CSS********************************************************** -->
<!-- ****************************************************************************************************************** -->

<!-- ****************************************************************************************************************** -->
<!-- ****************************************************Layout******************************************************** -->
<!-- ****************************************************************************************************************** -->
<!-- -----------------------------------start of page ------------------------------------ -->
<body style="margin: 0; padding: 0;">
    <br>
<div class="area" style="cursor: default;">
    <a class="button" onClick='download2()'>
        <i class="fa  fa-download"> </i>
        <Strong style="color: goldenrod">Download</Strong>
    </a>
    <a class="button" onClick='save()'>
        <i class="fa fa-cloud-download"> </i>
        <Strong style="color: goldenrod">Save</Strong>
    </a>
    <a class="button" onClick='load()'>
        <i class="fa fa-cloud-upload"> </i>
        <Strong style="color: goldenrod">Load</Strong>
    </a>
     <input type="file" id="input_file" style="display: none;"/>

    <label for="toggle1" class="toggle1">
        <input type="checkbox" id="toggle1" class="toggle1-input" onclick="if_preview()">
        <span class="toggle1-button"></span>
    </label>

    <h2 style="width: 383.92px;text-align: center; font-style: italic;">ADD TRIP</h2>
<!-- -----------------------------------auto------------------------------------------------ -->
    <HR style="border:1 dashed #987cb9" width="80%" color=#987cb9 SIZE=1>
    <br/>
    <table id="align-table-auto">
        <tr>
            <td>Name:</td>
            <td><input style="width:100px;" type='text' id='auto_name' value='JESSE'></td>
        </tr>
        <tr>
            <td>Amount Min:</td>
            <td><input style="width:100px;" type='text' id='auto_amount_min' value='120.12'></td>
            <td>Amount Max:</td>
            <td><input style="width:100px;" type='text' id='auto_amount_max' value='170.08'></td>
        </tr>
            <td>Date Start:</td>
            <td><input style="width:100px;" type='text' id='auto_date_start'></td>
            <td>Date End:</td>
            <td><input style="width:100px;" type='text' id='auto_date_end'></td>
        </tr>
        </tr>
            <td>Hour Morning:</td>
            <td><input style="width:100px;" type='text' id='auto_time_start1'></td>
            <td>Hour Night:</td>
            <td><input style="width:100px;" type='text' id='auto_time_start2'></td>
        </tr>
        <tr>
            <td>Minutes Min:</td>
            <td><input style="width:100px;" type='text' id='auto_cost_time_min' value='26'></td>
            <td>Minutes Max:</td>
            <td><input style="width:100px;" type='text' id='auto_cost_time_max' value='45'></td>
        </tr>
        </tr>
            <td>Place Start:</td>
            <td>
                <select id='auto_place_start'>
                    <option value='home'>HOME</option>
                    <option value='Puerta'>Puerta</option>
                    <option value='office'>OFFICE</option>
                    <option value='gsi'>GSI</option>
                    <option value='bienestar'>Bienestar</option>
                    <option value='bbva'>BBVA</option>
                    <option value='prosa'>PROSA</option>
                    <option value='M_airport'>M_airport</option>
                    <option value='M_office'>M_office</option>
                </select>
            </td>
            <td>Place End:</td>
            <td>
                <select id='auto_place_end'>
                    <option value='office'>OFFICE</option>
                    <option value='home'>HOME</option>
                    <option value='Puerta'>Puerta</option>
                    <option value='gsi'>GSI</option>
                    <option value='bienestar'>Bienestar</option>
                    <option value='bbva'>BBVA</option>
                    <option value='prosa'>PROSA</option>
                    <option value='M_airport'>M_airport</option>
                    <option value='M_office'>M_office</option>
                </select>
            </td>
        </tr>
    </table>
    <div class="commit">
        <div style="height: 39px;font-size: 34px;" onclick="commit_style();commit();">Click to Auto Trip</div>
    </div>
    <br/>

<!-- ---------------------------------------manual----------------------------------------- -->
    <HR style="border:1 dashed #987cb9" width="80%" color=#987cb9 SIZE=1>
    <table id="align-table">
        <tr>
            <td><button class="btn cir" onClick='random()'>Random</button></td>
            <td><button class="btn cir" onClick='ClearCache()'>Clear</button></td>
        </tr>
        <tr>
            <td>Order Amount:</td>
            <td><input type='text' id='amount' value='100.71'></td>
        </tr>
        <tr>
            <td>Time Start:</td>
            <td><input type='text' id='time_start' ></td>
        </tr>
        <tr>
            <td>Place Start:</td>
            <td>
                <select id='place_start'>
                    <option value='home'>HOME</option>
                    <option value='Puerta'>Puerta</option>
                    <option value='office'>OFFICE</option>
                    <option value='gsi'>GSI</option>
                    <option value='bienestar'>Bienestar</option>
                    <option value='bbva'>BBVA</option>
                    <option value='prosa'>PROSA</option>
                    <option value='M_airport'>M_airport</option>
                    <option value='M_office'>M_office</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>Time Arrive:</td>
            <td><input type='text' id='time_arrive' ></td>
        </tr>
        <tr>
            <td>Place Arrive:</td>
            <td>
                <select id='place_arrive'>
                    <option value='home'>HOME</option>
                    <option value='Puerta'>Puerta</option>
                    <option value='office'>OFFICE</option>
                    <option value='gsi'>GSI</option>
                    <option value='bienestar'>Bienestar</option>
                    <option value='bbva'>BBVA</option>
                    <option value='prosa'>PROSA</option>
                    <option value='M_airport'>M_airport</option>
                    <option value='M_office'>M_office</option>
                </select>
            </td>
        </tr>
    </table>
    <div style="text-align: center;">
    <button class="Button Button-sub" style="border-right: 100px;" onClick='ReduceTrip()' ><span>Reduce Trip</span></button>
    <button class="Button Button-plus" style="border-left: 100px;" onClick='AddTrip()' ><span>Add to Trip</span></button>
    </div>
</div>

<div id='preshow' style='position:absolute; left:500px; top:10px; border:1px solid #000'>

<!-- ****************************************************************************************************************** -->
<!-- ****************************************************Layout******************************************************** -->
<!-- ****************************************************************************************************************** -->

<script type="text/javascript">
    //******************************************************************************************************************
    //*****************************************************GLOBAL******************************************************* 
    //******************************************************************************************************************

    var place_home = 'Av. Río San Joaquín 12, Lomas de Sotelo, Miguel Hidalgo, 11200 Ciudad de México, CDMX, Mexico';
    var Puerta = 'Puerta, Argentina Poniente, Miguel Hidalgo, 11230 Ciudad de México, CDMX';
    var place_office = 'Nte. 31-A 36, Lindavista Vallejo III Secc, Gustavo A. Madero, 07720 Ciudad de México, CDMX, Mexico';
    var place_gsi = 'Priv. Rancho de La Cruz 98, Jamaica, Venustiano Carranza, 15800 Ciudad de México, CDMX, Mexico';
    var place_bienestar = 'Tizapán San Ángel, Progreso Tizapán, 01090  Ciudad de México';
    var place_bbva = 'Calz. Gral. Mariano Escobedo 303, Granada, 11520 Ciudad de México, CDMX';
    var place_prosa = 'Bahía de Chachalacas 7, Veronica Anzures, 11300 Miguel Hidalgo, DF, México';
    var M_airport = 'C. Priv. Belgrado 736, Centro de Guadalupe, 67100 Guadalupe, N.L., Monterrey';
    var M_office = 'Alhelí 202, Torres de Santo Domingo, 66440 San Nicolás de los Garza, N.L.，Monterrey';

    var place = [];
    place['home'] = place_home;
    place['Puerta'] = Puerta;
    place['office'] = place_office;
    place['gsi'] = place_gsi;
    place['bienestar'] = place_bienestar;
    place['bbva'] = place_bbva;
    place['prosa'] = place_prosa;
    place['M_airport'] = M_airport;
    place['M_office'] = M_office;

    //******************************************************************************************************************
    //*****************************************************GLOBAL******************************************************* 
    //******************************************************************************************************************

/**页面加载先加载日期选择器**/
$(function(){
$("#auto_date_start").datepicker({dateFormat:'dd/mm/yy'});
});
$(function(){
$("#auto_date_end").datepicker({dateFormat:'dd/mm/yy'});
});
$(function(){
    $("#auto_time_start1").timepicker({
        timeFormat: 'HH:mm',
        interval: 60,
        minTime: '8',
        maxTime: '20',
        defaultTime: '9',
        dynamic: false,
        dropdown: true,
        scrollbar: true
    });
});
$(function(){
    $("#auto_time_start2").timepicker({
        timeFormat: 'HH:mm',
        interval: 60,
        minTime: '8',
        maxTime: '20',
        defaultTime: '19',
        dynamic: false,
        dropdown: true,
        scrollbar: true
    });
});

$(function(){
$("#time_start").datetimepicker({format:'d/m/Y H:i'});
});

var parserDate = function (date) {  
    var t = Date.parse(date);  
    if (!isNaN(t)) {  
        return new Date(Date.parse(date.replace(/-/g, "/")));  
    } else {  
        return new Date();  
    }  
};
function random()
{
	$("#amount").val(randomNum(120.12, 180.08,0));
	
    var time_start_m = randomNum(0,59,1);
	var cost_time = randomNum(25,45,1);
	var time_start_day = ($("#time_start").val()).substring(0,11);
	var time_start_h = parseInt(($("#time_start").val()).substring(11,13));
    if(time_start_h/10 < 1){
        time_start_h = ('0'+time_start_h);
    }
    if(time_start_m/10 < 1){
        time_start_m = ('0'+time_start_m);
    }
    $("#time_start").val(time_start_day + time_start_h + ":" + time_start_m);
	time_start_m = parseInt(($("#time_start").val()).substring(14));
    var time_arrive_h = parseInt(($("#time_start").val()).substring(11,13));
	var time_arrive_m = time_start_m + cost_time;
	if(time_arrive_m >= 60){
	time_arrive_m -= 60;
	time_arrive_h += 1;
	}
	if(time_arrive_h/10 < 1){
		time_arrive_h = ('0'+time_arrive_h);
	}
	if(time_arrive_m/10 < 1){
		time_arrive_m = ('0'+time_arrive_m);
	}
	$("#time_arrive").val(time_start_day + time_arrive_h + ":" + time_arrive_m);
}

function randomNum(minNum,maxNum,isInt){ 
    if(isInt==1)
    {
    	return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10);
    }
    else
    {
    	return (Math.random()*(maxNum-minNum+1)+minNum).toFixed(2);
    }
}

function AddTrip()
{
    var amount = document.getElementById("amount").value;
    var time_start = document.getElementById("time_start").value;
    var place_start = document.getElementById("place_start").value;
    var time_arrive = document.getElementById("time_arrive").value;
    var place_arrive = document.getElementById("place_arrive").value;

    // alert('add:' + amount);
    // alert('this is ' + tripnum + ' trip');
    // alert('total amount:' + total);

    var len = arr_trip_table.length;
    arr_trip_table[len] = CreateObjectForArrTrip();
    arr_trip_table[len].amount = amount;
    arr_trip_table[len].time_start = time_start;
    arr_trip_table[len].place_start = place_start;
    arr_trip_table[len].time_arrive = time_arrive;
    arr_trip_table[len].place_arrive = place_arrive;

    preshow();
}

function ReduceTrip()
{
    arr_trip_table.pop();
    preshow();
}

function DeleteTrip(i)
{
    arr_trip_table.splice(i, 1);
    preshow();
}

function InsertTrip(i)
{
    var amount = document.getElementById("amount").value;
    var time_start = document.getElementById("time_start").value;
    var place_start = document.getElementById("place_start").value;
    var time_arrive = document.getElementById("time_arrive").value;
    var place_arrive = document.getElementById("place_arrive").value;

    var trip = CreateObjectForArrTrip();
    trip.amount = amount;
    trip.time_start = time_start;
    trip.place_start = place_start;
    trip.time_arrive = time_arrive;
    trip.place_arrive = place_arrive;

    arr_trip_table.splice(i, 0, trip);

    preshow();
}

function preshow()
{
    if(arr_trip_table.length == 0) 
    {
        document.getElementById("preshow").innerHTML = "";
        return;
    }
    var mode = (document.getElementById("toggle1").checked == true ? 0 : 1);
    switch(mode)
    {
        case 0:
        {
            var receipt = GetReceipt();
            document.getElementById("preshow").innerHTML=receipt;
        }
        break;

        case 1:
        {
            var table = '\
<table id="align-table" border="1" style="border-collapse: collapse;">\
    <tr>\
        <th bgcolor="#FF0000" style="padding: 2px 1px;text-align:center;">DEL</th>\
        <th bgcolor="#6495ED"style="padding: 2px 1px;text-align:center">INS</th>\
        <th>amount</th>\
        <th>time_start</th>\
        <th>place_start</th>\
        <th>time_arrive</th>\
        <th>place_arrive</th>\
    </tr>';

            for(var i in arr_trip_table)
            {
                table += '\
    <tr>\
        <td style="padding: 2px 1px;text-align:center;"><input style="border-radius:30px;" type="button" name="delete" value="X" onclick="DeleteTrip(' + i +')"></td>\
        <td style="padding: 2px 1px;text-align:center;"><input style="border-radius:0px;" type="button" name="insert" value="+" onclick="InsertTrip(' + i +')"></td>\
        <td>' + arr_trip_table[i].amount + '</td>\
        <td>' + arr_trip_table[i].time_start + '</td>\
        <td>' + arr_trip_table[i].place_start + '</td>\
        <td>' + arr_trip_table[i].time_arrive + '</td>\
        <td>' + arr_trip_table[i].place_arrive + '</td>\
    </tr>';
            }
            table += '\
</table>';
            document.getElementById("preshow").innerHTML=table;
        }
    }
}

function GetReceipt()
{
var start = '<?xml version="1.0" encoding="UTF-8"?>\n\
<!DOCTYPE html\n\
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"\n\
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n\
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">\n\
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n\
<head>\n\
    <title>Receipt</title>\n\
</head>\n\
<body style="margin: 0; padding: 0;">\n\
';
var end = '</body>\n\
</html>\n\
';

var body = '';

var tbody_s = '\
<table cellpadding="0" cellspacing="0" width="100%" style="padding: 24px 36px">\n\
    <tbody>\n\
    <tr>\n\
        <td>\n\
            <table align="center" cellpadding="0" cellspacing="0" width="800" style="border-collapse: collapse;">\n\
                <tbody>\n\
';
var tr_didi = '\
                <tr>\n\
                    <td>\n\
                        <table style="padding: 17px 0 30px" cellpadding="0" cellspacing="0">\n\
                            <tr>\n\
                                <td>\n\
                                    <img src="https://pt-starimg.didistatic.com/static/starimg/img/1515564055216fbtUSN2gUZIkEVfOzfc.png" style="width: 60px;height: 48px;" alt=""/>\n\
                                </td>\n\
                                <td>\n\
                                    <span style="font-size: 28px;color: #999999;margin-left: 27px">Thanks to use DiDi</span>\n\
                                </td>\n\
                            </tr>\n\
                        </table>\n\
                    </td>\n\
                </tr>\n\
                <tr>\n\
                    <td>\n\
                        <span style="border-top: 1px solid #E1E2E6;display:block;"></span>\n\
                    </td>\n\
                </tr>\n\
';
var tbody_e = '\
                </tbody>\n\
            </table>\n\
        </td>\n\
    </tr>\n\
    </tbody>\n\
</table>\n\
';

//trip
var trip_body = '';

var trip_s = '\
                <tr>\n\
                    <td>\n\
                        <span style="border-top: 1px solid #E1E2E6;display:block;"></span>\n\
                    </td>\n\
                </tr>\n\
                <tr>\n\
                    <td>\n\
                        <table style="padding-bottom: 40px" cellpadding="0" cellspacing="0">\n\
                            <!-- 订单列表 -->\n\
';
 var trip_e = '\
                        </table>\n\
                    </td>\n\
                </tr>\n\
';

var didi_thanks = '\
                <tr style="display:none">\n\
                    <td>\n\
                        <span style="border-top: 1px solid #E1E2E6;display:block;"></span>\n\
                    </td>\n\
                </tr>\n\
                <tr style="display:none">\n\
                    <td>\n\
                        <table style="padding: 40px 0" cellpadding="0" cellspacing="0">\n\
                            <tr>\n\
                                <td style="font-size:24px;">place_holder_notice_title</td>\n\
                            </tr>\n\
                            <tr>\n\
                                <td style="font-size:20px;">place_holder_notice_msg1</td>\n\
                            </tr>\n\
                            <tr>\n\
                                <td style="font-size:20px;">place_holder_notice_msg2</td>\n\
                            </tr>\n\
                            <tr>\n\
                                <td style="font-size:20px;">place_holder_notice_msg3</td>\n\
                            </tr>\n\
                        </table>\n\
                    </td>\n\
                </tr>\n\
                <tr>\n\
                    <td>\n\
                        <span style="border-top: 1px solid #E1E2E6;display:block;"></span>\n\
                    </td>\n\
                </tr>\n\
                <tr>\n\
                    <td>\n\
                        <table style="padding: 40px 0" cellpadding="0" cellspacing="0">\n\
                            <tr>\n\
                                <td style="font-size: 28px;font-weight: bold">Contact DiDi</td>\n\
                            </tr>\n\
                            <tr>\n\
                                <td style="font-size: 22px;color: #999999;padding-top: 10px">Please contact us if you have any questions.</td>\n\
                            </tr>\n\
                            <tr>\n\
                                <td style="padding-top: 10px;font-size: 22px;color: #999999;">Email: didireceipts@didiglobal.com</td>\n\
                            </tr>\n\
                        </table>\n\
                    </td>\n\
                </tr>\n\
                <tr>\n\
                    <td>\n\
                        <table style="padding: 50px 0 20px;width: 100%;" cellpadding="0" cellspacing="0">\n\
                            <tr>\n\
                                <td style="text-align:center; padding-top: 10px;font-size: 22px;color: #c2c2c2;">DiDi Mobility Information Technology Pte. Ltd. 152 Beach Road, #14-02,\n\
Gateway East, Singapore 189721</td>\n\
                            </tr>\n\
                        </table>\n\
                    </td>\n\
                </tr>\n\
';

var tr_total = '';
var receipt = '';

var ftotal = 0.00;
var total = '';
var tripnum = 0;
trip_body = '';
for(var i = 0; i < arr_trip_table.length; i++)
{
    tripnum++;
    ftotal = ftotal.add(Number(arr_trip_table[i].amount));

    var tmpbody = '\
                <tr>\n\
                    <td style="font-size: 32px;font-weight: bold;padding-top: 40px">Order Amount:  MXN$'+arr_trip_table[i].amount+'</td>\n\
                </tr>\n\
                <tr>\n\
                    <td style="font-size: 26px;font-weight: bold;padding-top: 10px"></td>\n\
                </tr>\n\
                <tr>\n\
                    <td style="font-size: 26px"></td>\n\
                </tr>\n\
                <tr>\n\
                    <td style="font-size: 26px;color: #999999;padding-top: 20px">\n\
                    <!--出发时间-->\n\
                    '+arr_trip_table[i].time_start+'\n\
                    </td>\n\
                </tr>\n\
                <tr>\n\
                    <td>\n\
                        <table cellpadding="0" cellspacing="0" style="padding-top: 10px;">\n\
                            <tr>\n\
                                <td>\n\
                                    <span style="width: 12px;height: 12px;background: #00D0AD;border-radius: 100%;display: inline-block"></span>\n\
                                </td>\n\
                                <td style="font-size: 26px;padding-left: 14px">\n\
                                    From: '+place[arr_trip_table[i].place_start]+'\n\
                                </td>\n\
                            </tr>\n\
                        </table>\n\
                    </td>\n\
                \n\
                </tr>\n\
                <tr>\n\
                    <td style="font-size: 26px;color: #999999;padding-top: 10px">\n\
                    <!--到达时间-->\n\
                    '+arr_trip_table[i].time_arrive+'\n\
                    </td>\n\
                </tr>\n\
                <tr>\n\
                    <td>\n\
                        <table cellpadding="0" cellspacing="0" style="padding-top: 10px;">\n\
                            <tr>\n\
                                <td>\n\
                                    <span style="width: 12px;height: 12px;background: #FF7733;border-radius: 100%;display: inline-block"></span>\n\
                                </td>\n\
                                <td style="font-size: 26px;padding-left: 14px">\n\
                                    To: '+place[arr_trip_table[i].place_arrive]+'\n\
                                </td>\n\
                            </tr>\n\
                        </table>\n\
                    </td>\n\
                </tr>\n\
    ';
    trip_body += tmpbody;
}
total = ftotal.toFixed(2);

tr_total = '\
                <tr>\n\
                    <td>\n\
                        <table style="padding: 36px 0 40px" cellpadding="0" cellspacing="0">\n\
                            <tr>\n\
                                <td style="font-size: 40px;font-weight: bold">Hello '+ document.getElementById('auto_name').value +'</td>\n\
                            </tr>\n\
                            <tr>\n\
                                <td style="padding-top: 28px;font-weight: bold">\n\
                                    <span style="font-size: 32px;">Total order amount:</span>\n\
                                    <span style="font-size: 44px;color: #FF7226;margin-left: 20px"> MXN$'+total+'</span>\n\
                                </td>\n\
                            </tr>\n\
                            <tr>\n\
                                <td style="padding-top: 16px;">\n\
                                    <span style="font-size: 28px;">Trip Number:</span>\n\
                                    <span style="padding-left: 16px;font-weight: bold;font-size: 32px;font-weight: bold">'+tripnum+'</span>\n\
                                </td>\n\
                            </tr>\n\
                        </table>\n\
                    </td>\n\
                </tr>\n\
';
var trip = trip_s + trip_body + trip_e;

body = tbody_s + tr_didi + tr_total + trip + didi_thanks + tbody_e;

receipt = start + body + end;

return receipt;
}
    
function download(filename, text)
{
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);
 
  element.style.display = 'none';
  document.body.appendChild(element);
 
  element.click();
 
  document.body.removeChild(element);
}

Date.prototype.Format = function(formatStr)
{
    var str = formatStr;
    var Week = ['日','一','二','三','四','五','六'];
  
    str=str.replace(/yyyy|YYYY/,this.getFullYear());
    str=str.replace(/yy|YY/,(this.getYear() % 100)>9?(this.getYear() % 100).toString():'0' + (this.getYear() % 100));
  
    str=str.replace(/MM/,this.getMonth()>=9?(this.getMonth()+1).toString():'0' + (this.getMonth()+1));
    str=str.replace(/M/g,(this.getMonth()+1));
  
    str=str.replace(/w|W/g,Week[this.getDay()]);
  
    str=str.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():'0' + this.getDate());
    str=str.replace(/d|D/g,this.getDate());
  
    str=str.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():'0' + this.getHours());
    str=str.replace(/h|H/g,this.getHours());
    str=str.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():'0' + this.getMinutes());
    str=str.replace(/m/g,this.getMinutes());
  
    str=str.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():'0' + this.getSeconds());
    str=str.replace(/s|S/g,this.getSeconds());
  
    return str;
}
function download2()
{
    var date = new Date();
    var receipt = GetReceipt();
    download('DiDi' + date.Format('YYYYMMDD') +  ".html", receipt);
}

/**
 ** 加法函数，用来得到精确的加法结果
 ** 说明：javascript的加法结果会有误差，在两个浮点数相加的时候会比较明显。这个函数返回较为精确的加法结果。
 ** 调用：accAdd(arg1,arg2)
 ** 返回值：arg1加上arg2的精确结果
 **/
function accAdd(arg1, arg2) {
    var r1, r2, m, c;
    try {
        r1 = arg1.toString().split(".")[1].length;
    }
    catch (e) {
        r1 = 0;
    }
    try {
        r2 = arg2.toString().split(".")[1].length;
    }
    catch (e) {
        r2 = 0;
    }
    c = Math.abs(r1 - r2);
    m = Math.pow(10, Math.max(r1, r2));
    if (c > 0) {
        var cm = Math.pow(10, c);
        if (r1 > r2) {
            arg1 = Number(arg1.toString().replace(".", ""));
            arg2 = Number(arg2.toString().replace(".", "")) * cm;
        } else {
            arg1 = Number(arg1.toString().replace(".", "")) * cm;
            arg2 = Number(arg2.toString().replace(".", ""));
        }
    } else {
        arg1 = Number(arg1.toString().replace(".", ""));
        arg2 = Number(arg2.toString().replace(".", ""));
    }
    return (arg1 + arg2) / m;
}
 
//给Number类型增加一个add方法，调用起来更加方便。
Number.prototype.add = function (arg) {
    return accAdd(arg, this);
};

function if_preview()
{
    preshow();
}

function save()
{
    var data = JSON.stringify(arr_trip_table);
    download('tmpTrip.dat', data);
}

function load()
{
    document.getElementById('input_file').click();
}


function upload() 
{
    var file = this.files[0];
    var reader = new FileReader();
    if(!/\.dat$/.test(file.name)){
        alertify.alert("Please make sure to select .dat file!");
        input_file.value = '';
        return false;
    }
    reader.readAsText(file);
    reader.onload = function(ev) {
        if(arr_trip_table.length != 0)
        {
            if(!confirm("You already add some trip, are you sure to reload the old data?"))
            {
                return;
            }
        }
        arr_trip_table = JSON.parse(this.result);
        preshow();
    }
    input_file.value = '';
    return true;
}

    //******************************************************************************************************************
    //*****************************************************GLOBAL******************************************************* 
    //******************************************************************************************************************

    var input_file=document.getElementById("input_file");
    if (window.FileReader) 
    {
        input_file.addEventListener("change",upload,false);
    } 
    else
    {
        alertify.alert("This browser doesn't support!");
    }

    var arr_trip_table = new Array();

    var err = {};
    err[-1] = "Too late hour or too many minutes";
    err[0] = "success";

    //******************************************************************************************************************
    //*****************************************************GLOBAL******************************************************* 
    //******************************************************************************************************************

function CreateObjectForArrTrip()
{
    var dic_trip = {};
    dic_trip.amount = '';
    dic_trip.time_start = '';
    dic_trip.place_start = '';
    dic_trip.time_arrive = '';
    dic_trip.place_arrive = '';
    return dic_trip;
}
function commit()
{
    var flag = 0;
    // CheckValidInput();
    var auto_name = document.getElementById('auto_name').value;
    var auto_amount_min = parseFloat(document.getElementById('auto_amount_min').value);
    var auto_amount_max = parseFloat(document.getElementById('auto_amount_max').value);
    var auto_cost_time_min = parseInt(document.getElementById('auto_cost_time_min').value);
    var auto_cost_time_max = parseInt(document.getElementById('auto_cost_time_max').value);
    var auto_h1 = parseInt(($("#auto_time_start1").val()).substring(0,2));
    var auto_h2 = parseInt(($("#auto_time_start2").val()).substring(0,2));
    var auto_place1 = document.getElementById('auto_place_start').value;
    var auto_place2 = document.getElementById('auto_place_end').value;

    if(!auto_name)
    {
        alertify.alert("Please input name!");
        return;
    }
    if(isNaN(auto_amount_min) || isNaN(auto_amount_max) || auto_amount_min <= 0 
        || auto_amount_max <= 0 || auto_amount_min >= auto_amount_max)
    {
        alertify.alert("Please input correct amount");
        return;
    }
    if(isNaN(auto_cost_time_min) || isNaN(auto_cost_time_max) || auto_cost_time_min <= 0 
        || auto_cost_time_max <= 0 || auto_amount_min >= auto_amount_max)
    {
        alertify.alert("Please input appropriate cost time");
        return;
    }
    if(isNaN(auto_h1) || isNaN(auto_h2) || auto_h1 < 1 || auto_h1 > 23 
        || auto_h2 < 1 || auto_h2 > 23 || auto_h1 >= auto_h2)
    {
        alertify.alert("Please input hours appropriately");
        return;
    }
    if(auto_place1 == auto_place2)
    {
        alertify.alert("Please select different place");
        return;
    }

    var date_start = document.getElementById('auto_date_start').value;
    var date_end = document.getElementById('auto_date_end').value;
    if(!isValid(date_start) || !isValid(date_end))
    {
        alertify.alert("please select correct date!");
        return;
    }
    var date = date_start.split('/');
    var start = date[2] + '/' + date[1] + '/' + date[0];
    date = date_end.split('/');
    var end = date[2] + '/' + date[1] + '/' + date[0];
    var loop = new Date(start);
    var loop_end = new Date(end);
    if(loop > loop_end)
    {
        alertify.alert("Start date bigger than end date!");
        return;
    }
    while(loop <= loop_end)
    {
        if(loop.getDay() != 0 && loop.getDay() != 6)
        {
            // alert(loop.toString());
            var auto_time_start  = loop.Format('DD/MM/YYYY');
            var auto_time_start_h1 = ($("#auto_time_start1").val()).substring(0,2);
            var auto_time_start_h2 = ($("#auto_time_start2").val()).substring(0,2);
            var auto_place_start = document.getElementById('auto_place_start').value;
            var auto_place_end = document.getElementById('auto_place_end').value;

            if((flag = AutoAddTrip(auto_time_start, auto_time_start_h1, auto_place_start, auto_place_end)) != 0 
                || (flag = AutoAddTrip(auto_time_start, auto_time_start_h2, auto_place_end, auto_place_start)) !=0 )
            {
                ClearCache();
                break;
            }
        }
        var newDate = loop.setDate(loop.getDate() + 1);
        loop = new Date(newDate);
    }
    if(flag < 0)
    {
        alertify.error("Follow the rules!");
        alertify.prompt(err[flag] + ', Type "I Agree" to redo everything!', function (e, str) {
            if (e) {
                if(str != "I Agree") window.close();
            } else {
                window.close();
            }
        }, "");
    }
    preshow();
}
function AutoAddTrip(auto_time_start, auto_time_start_h, auto_place_start, auto_place_arrive)
{
    var flag = 0;

    var auto_amount_min = parseFloat(document.getElementById('auto_amount_min').value);
    var auto_amount_max = parseFloat(document.getElementById('auto_amount_max').value);
    var auto_cost_time_min = parseInt(document.getElementById('auto_cost_time_min').value);
    var auto_cost_time_max = parseInt(document.getElementById('auto_cost_time_max').value);

    var auto_amount = randomNum(auto_amount_min, auto_amount_max, 0);
    var auto_time_start =  auto_time_start + ' ';
    var auto_time_arrive = auto_time_start;
    var auto_time_start_m = randomNum(0,59,1);//number
    
    var auto_cost_time = randomNum(auto_cost_time_min,auto_cost_time_max,1);//number
    var auto_time_arrive_h = parseInt(auto_time_start_h);//number
    auto_time_start_h = auto_time_arrive_h;
    var auto_time_arrive_m = auto_time_start_m + auto_cost_time;
    while(auto_time_arrive_m >= 60){
        auto_time_arrive_m -= 60;
        auto_time_arrive_h += 1;
        if(auto_time_arrive_h > 23)
        {
            flag = -1;
            return flag;
        }
    }
    if(auto_time_arrive_h/10 < 1){
        auto_time_arrive_h = ('0'+auto_time_arrive_h);
    }
    if(auto_time_arrive_m/10 < 1){
        auto_time_arrive_m = ('0'+auto_time_arrive_m);
    }
    if(auto_time_start_m/10 < 1){
        auto_time_start_m = ('0'+auto_time_start_m);
    }
    if(auto_time_start_h/10 < 1){
        auto_time_start_h = ('0'+auto_time_start_h);
    }
    auto_time_start = auto_time_start + auto_time_start_h + ':' + auto_time_start_m;
    auto_time_arrive = auto_time_arrive + auto_time_arrive_h + ':' + auto_time_arrive_m;

    var len = arr_trip_table.length;
    arr_trip_table[len] = CreateObjectForArrTrip();
    arr_trip_table[len].amount = auto_amount;
    arr_trip_table[len].time_start = auto_time_start;
    arr_trip_table[len].place_start = auto_place_start;
    arr_trip_table[len].time_arrive = auto_time_arrive;
    arr_trip_table[len].place_arrive = auto_place_arrive;
    return flag;
}
function ClearCache()
{
    arr_trip_table.splice(0, arr_trip_table.length);
    preshow();
}
function isValid(date)
{
    var DA = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    if(!date) return false;
    var arr = date.split('/');
    if(arr.length != 3) return false;
    if(arr[2].length != 4 || arr[1].length != 2 || arr[0].length != 2)
        return false;
    y = parseInt(arr[2], 10);
    m = parseInt(arr[1], 10);
    d = parseInt(arr[0], 10);
    if(isNaN(y) || isNaN(m) || isNaN(d)) return false;
    if(m > 12 || m < 1) return false;
    if(isLoopYear(y)) DA[2] = 29;
    if(d > DA[m]) return false;
    return true;
}
function isLoopYear(theYear) {
    return (new Date(theYear, 1, 29).getDate() == 29);
}
</script>
<script type="text/javascript">
    var $button = document.querySelector(".commit");
    function commit_style() {
      var duration = 0.3,
        delay = 0.08;
      TweenMax.to($button, duration, { scaleY: 1.6, ease: Expo.easeOut });
      TweenMax.to($button, duration, {
        scaleX: 1.2,
        scaleY: 1,
        ease: Back.easeOut,
        easeParams: [3],
        delay: delay
      });
      TweenMax.to($button, duration * 1.25, {
        scaleX: 1,
        scaleY: 1,
        ease: Back.easeOut,
        easeParams: [6],
        delay: delay * 3
      });
}
</script>
</body>
<meta name="release" content="
v2.0: generate table list to insert/delete
v2.1: support to save temporary data
v3.0: auto generate">
</html>
